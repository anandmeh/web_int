<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Display a GPT-managed web interstitial ad." />
    <title>Display a web interstitial ad</title>

    <!-- GPT script -->
    <script
      async
      src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"
      crossorigin="anonymous"
    ></script>

    <!-- Klaro Consent Manager -->
    <link rel="stylesheet" href="https://cdn.kiprotect.com/klaro/v0.10.22/klaro.css" />
    <script src="https://cdn.kiprotect.com/klaro/v0.10.22/klaro.js"></script>
    <script>
      window.klaroConfig = {
        version: 1,
        elementID: 'klaro',
        privacyPolicy: 'https://www.example.com/privacy-policy',
        apps: [
          {
            name: 'gptAds',
            title: 'Google Publisher Tags',
            purposes: ['advertising'],
            cookies: ['_gads', 'IDE', 'DSID'],
            required: false,
          },
        ],
      };
    </script>

    <script>
      window.googletag = window.googletag || { cmd: [] };

      let interstitialSlot;

      googletag.cmd.push(() => {
        // Define a web interstitial ad slot.
        interstitialSlot = googletag.defineOutOfPageSlot(
          "135050247/BT/interstitial",
          googletag.enums.OutOfPageFormat.INTERSTITIAL
        );

        if (interstitialSlot) {
          interstitialSlot.setTargeting("queryString", "interstitial_test");

          interstitialSlot.addService(googletag.pubads()).setConfig({
            interstitial: {
              triggers: {
                navBar: true,
                unhideWindow: true,
              },
            },
          });

          document.getElementById("status").textContent = "Interstitial is loading...";

          googletag.pubads().addEventListener("slotOnload", (event) => {
            if (interstitialSlot === event.slot) {
              document.getElementById("link").style.display = "block";
              document.getElementById("status").textContent = "Interstitial is loaded.";
            }
          });
        }

        googletag.setConfig({
          singleRequest: true,
        });

        googletag.enableServices();
      });
    </script>

    <style>
      #link {
        display: none;
      }

      div.content {
        position: fixed;
        top: 50%;
      }
    </style>
  </head>

  <body>
    <div id="klaro"></div> <!-- Consent banner container -->

    <div id="static-ad-1" style="width: 100px; height: 100px"></div>

    <div class="content">
      <span id="status">Web interstitial is not supported on this page.</span>
      <p>
        <a id="link" href="https://www.example.com/">TRIGGER INTERSTITIAL</a>
      </p>
      <p>
        <a data-google-interstitial="false" href="https://www.example.com/">
          This link will never trigger an interstitial
        </a>
      </p>
    </div>

    <script>
      // Only display GPT ads after user consent
      klaro.run().then(() => {
        const consent = klaro.getConsentFor('gptAds');
        if (consent) {
          googletag.cmd.push(() => {
            googletag.display(interstitialSlot);
          });
        }
      });
    </script>
  </body>
</html>
