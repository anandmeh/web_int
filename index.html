<script>
  window.googletag = window.googletag || { cmd: [] };

  // Run Klaro first
  klaro.run().then(() => {
    const consent = klaro.getConsentFor('gptAds');
    if (!consent) return; // Stop if no consent

    googletag.cmd.push(() => {
      // Define interstitial only after consent
      const interstitialSlot = googletag.defineOutOfPageSlot(
        "135050247/BT/interstitial",
        googletag.enums.OutOfPageFormat.INTERSTITIAL
      );

      if (interstitialSlot) {
        interstitialSlot.setTargeting("queryString", "interstitial_test");
        interstitialSlot.addService(googletag.pubads()).setConfig({
          interstitial: {
            triggers: {
              navBar: true,
              unhideWindow: true,
            },
          },
        });

        document.getElementById("status").textContent = "Interstitial is loading...";

        googletag.pubads().addEventListener("slotOnload", (event) => {
          if (interstitialSlot === event.slot) {
            document.getElementById("link").style.display = "block";
            document.getElementById("status").textContent = "Interstitial is loaded.";
          }
        });
      }

      googletag.setConfig({ singleRequest: true });
      googletag.enableServices();
      googletag.display(interstitialSlot);
    });
  });
</script>
